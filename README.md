# QLINE（クライン）
![header icon](resource/logo.png)


## 製品概要
### 動画
[![Product Name](image.png)](https://www.youtube.com/watch?v=G5rULR53uMk)

### テーマ：行列 × Tech
##### 行列を『見える化』する QLINE（クライン）

### 背景
大学生は日常の中で数多くの行列に出会います。
- お気に入りのラーメン屋に行ってみたら行列でとても入れなかった
- 短い昼休憩の中行った食堂が長蛇の列で講義に遅れてしまった

など、行列に悩まされたことのない大学生はいないでしょう。もちろん、これは大学生に限った話ではありません。

そこで私たちは、無駄な時間やストレスを生み出すこの行列を可視化できないか注目しました。私たちが提案するのは、行列を避け限られた時間を有意義に利用できるサービス **「QLINE」** です。

このQLINEを開発するにあたって私たちは3つの仮定を置きました。
　　
##### 1. 行列の意義
店側にとって行列には「繁盛の印・店の広告」という意味が、そして並んでる人にとっては「行列のできる店で美味しいものを食べる」という意味がある。したがって、行列を「0」にするよりも、「過度な行列を緩和する」アプローチのほうが有効である。

##### 2. 行列の原因
行列の原因はある時間に需要が集中するためであり、人々がある行列に並び始めるタイミングを調整すれば行列は緩和されるはずである。

##### 3. サービスの障壁
たとえ店側が顧客満足度のために過度な行列を緩和したいと考えても、新しい技術やツールの導入コスト・ワークフローの変更にはためらってしまう。

#### 既存プロダクトの問題点
行列による待ち時間に関する既存のサービスにも、以下のような問題点があります。
##### Google Map
ユーザから獲得した統計情報をもとに混雑度を表示しますが、リアルタイムに混雑状況が反映されるわけではありません。また、ユーザの行動が把握されるプライバシー上の問題もあります。
##### O:der
アプリを通じたリモート受付・予約を提供するサービスですが、アプリを使っている人の情報しか得られません。さらに、店側はワークフローを変更する必要があります。

### 製品説明
このサービスでは、店先にネットワークカメラを設置するだけで映像から行列の人数を検出し、並んでいる人数だけでなくおおよその待ち時間も計算し、客に通知する機能を提供します。
このサービスによって、客はいつでも目当ての店の混雑度合いをリアルタイムに知ることができます。それだけではなく、常に行列を監視することで店側にも行列をコントロールするための情報を提供します。

### 特長

#### 1. Plug & Go の IoT カメラ
電源をつなぎ、ネットワークに接続するだけで動き出します。オーナーや店員がワークフローを変更する必要はありません。

#### 2. あらゆるデバイスからアクセス
LINE Messaging API と連携し、インストール不要で行列の様子を知ることができます。LINE が使えないユーザに対しても、Web サービスを提供しています。

#### 3. 最先端の物体検出
ChainerCV を用いて、最新の物体検知テクノロジーを利用しています。今回は、学習済みの YOLO v3 モデルを用いて物体検出を用いて画像から人物の人数を推定しています。

### 解決できること

#### 行列に並ぶ時間を短く
スマートフォンから LINE でメッセージを送るだけで、気になるお店の待ち時間の状況がリアルタイムにわかります。待ち時間が長ければ他のことをして後で行くもよし、今日はあきらめて他の店を発掘するのもよし。ただ行列を待つよりも、充実した時間が過ごせます。

#### ワークフローを変えることなく、来客数の最適化

客の来店数をリアルタイムに監視することで、行列を適切な長さに調整するのに役立ちます。また、導入はデバイスを設置してネットワークに接続するだけという手軽さで、店のワークフローを変更する必要はありません。今まで通りの注文・調理フローで来客ピークの忙しさを緩和します。

### ユーザーインタビュー

##### @東京大学生協本郷中央食堂
このサービスのアイデアを検証するために、東京大学生協本郷中央食堂の小里様にユーザーインタビューをお願いしました。ユーザーインタビューの中では次のような知見が得られました。東京大学生協本郷中央食堂の小里様、ありがとうございました。

- 東京大学生協としてもピーク時の行列を課題と捉えている。行列に並んでいる時間を検証したところ、列が長くても7〜8分でレジまで行けることを確認している。また、声掛けなどの対策も行っている。
- ピーク時でも人の少ない列と多い列ができてしまうという課題もある。特に、ポムの木側の人数が少ないといった問題や、一人一人の処理時間が短いキャシュレス限定のレジよりも現金レーンに並んでいる人が多いという問題がある。
- 既存サービスのようなオンライン上での予約制では、誰にできた料理を出してよいのかわからない。
- もしカメラを設置する場合には、東京大学等に相談が必要。

### 今後の展望
このサービスは、今後さらに以下のように展開していくことが考えられます。
- 周辺の店舗のレコメンド
  - お店が混雑している場合、似たジャンルのお店をレコメンドしてくれる機能です。
- 同一人物推定
  - 行列を監視する際、同一の人物がどのくらいの時間並んでいるかといったデータは混雑度の推定や待ち時間の把握に役立ちます。
- 複数列の認識
  - ユーザーインタビューでも触れられていたとおり、複数の列がある場合にそれぞれを個別に監視する機能です。
また、実際に大学生協側と交渉し、実際に設置して試験運用してもらうことも考えています。

## 開発内容・開発技術
### 活用した技術
##### API・データ
- Amazon EC2
- LINE Messaging API
- Heroku

##### フレームワーク・ライブラリ・モジュール
- Python 3
  - Flask
  - ChainerCV / Chainer
- JavaScript
  - React
  - Node.js

##### デバイス
- Rasberry Pi + USBカメラ
- どんぶり

### 独自開発技術（Hack Day で開発したもの）
#### 2日間に開発した独自の機能・技術

##### 画像中の人物認識による行列の待ち時間推定
行列の状態を物体認識によって監視し、人物の増減から待ち時間を高速に推定します。
